<blockquote><h1 id="用-RenderDoc-持续截帧-Unity-Editor-Game-View">用 RenderDoc 持续截帧 Unity Editor Game View<a class="headerlink" href="#用-RenderDoc-持续截帧-Unity-Editor-Game-View" title="Permanent link">&para;</a></h1>
<!-- more -->

<p>某些渲染 bug 只会持续很短的时间，手动抓帧根本抓不到。Unity 在 <code>UnityEditorInternal</code> 命名空间下，提供了 <a href="https://github.com/Unity-Technologies/UnityCsReference/blob/d2eb9c0352229c0268d47ca0efa69e14b5d180f8/Editor/Mono/RenderDoc/RenderDoc.bindings.cs#L32"><code>RenderDoc.BeginCaptureRenderDoc</code></a> 和 <a href="https://github.com/Unity-Technologies/UnityCsReference/blob/d2eb9c0352229c0268d47ca0efa69e14b5d180f8/Editor/Mono/RenderDoc/RenderDoc.bindings.cs#L34C28-L34C47"><code>RenderDoc.EndCaptureRenderDoc</code></a> 方法。可以用它们对 Game View 持续截帧。</p>
<h2 id="代码">代码<a class="headerlink" href="#代码" title="Permanent link">&para;</a></h2>
<p>随便给的快捷键：</p>
<ul>
<li>Alt+Shift+B 开始截帧</li>
<li>Alt+Shift+E 结束截帧</li>
</ul>
<p>为了防止和其他快捷键冲突，所以给得比较反人类。不过用的频率比较低，所以可以接受。</p>
<p>同时开多个 Game View 可能有问题，一个都不开必有问题。</p>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditor.ShortcutManagement</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEditorInternal</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RenderDocUtils</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Shortcut(&quot;RenderDocUtils/BeginCaptureGameView&quot;, KeyCode.B, ShortcutModifiers.Alt | ShortcutModifiers.Shift)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">BeginCaptureGameView</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">RenderDoc</span><span class="p">.</span><span class="n">BeginCaptureRenderDoc</span><span class="p">(</span><span class="n">GetActiveGameView</span><span class="p">());</span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;RenderDoc capture started&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Shortcut(&quot;RenderDocUtils/EndCaptureGameView&quot;, KeyCode.E, ShortcutModifiers.Alt | ShortcutModifiers.Shift)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EndCaptureGameView</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">RenderDoc</span><span class="p">.</span><span class="n">EndCaptureRenderDoc</span><span class="p">(</span><span class="n">GetActiveGameView</span><span class="p">());</span>
<span class="w">        </span><span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&quot;RenderDoc capture ended&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">EditorWindow</span><span class="w"> </span><span class="nf">GetActiveGameView</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">SceneView</span><span class="p">).</span><span class="n">Assembly</span><span class="p">.</span><span class="n">GetType</span><span class="p">(</span><span class="s">&quot;UnityEditor.GameView&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EditorWindow</span><span class="p">.</span><span class="n">GetWindow</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></blockquote>