<blockquote>(*/ω＼*)</blockquote><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>各种发行版都不一样，Arch直接<code>sudo pacman -S docker</code>就行。</p><p>安装完毕后，输入<code>sudo systemctl enable --now docker.service</code>启动Docker服务。</p><h3 id="权限配置"><a href="#权限配置" class="headerlink" title="权限配置"></a>权限配置</h3><p>想不用<code>sudo</code>就用Docker，那就得配置用户组权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker  <span class="comment"># ensure the usergroup docker exists</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span>  <span class="comment"># add curr user to docker group</span></span><br></pre></td></tr></table></figure><h3 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速#"></a>镜像加速<a href="https://www.cnblogs.com/qianyuzz/p/18016205#%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F">#</a></h3><p>我使用的是<a href="https://cr.console.aliyun.com/cn-shenzhen/instances/mirrors">阿里云镜像</a></p><ol><li><p>安装／升级Docker客户端<br> 推荐安装1.10.0以上版本的Docker客户端，参考文档docker-ce</p></li><li><p>配置镜像加速器</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@Ubuntu:~<span class="comment"># vim /etc/docker/daemon.json</span></span><br><span class="line">root@Ubuntu:~<span class="comment"># sudo systemctl daemon-reload</span></span><br><span class="line">root@Ubuntu:~<span class="comment"># sudo systemctl restart docker</span></span><br><span class="line">root@Ubuntu:~<span class="comment"># cat /etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">          <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://xxxxxx.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最后使用<code>docker info</code> 就可以查看是否更换镜像成功。</p><h2 id="使用指南"><a href="#使用指南" class="headerlink" title="使用指南"></a>使用指南</h2><h3 id="离线使用"><a href="#离线使用" class="headerlink" title="离线使用"></a>离线使用</h3><blockquote><p>最近国内docker镜像都歇菜之后，倒也该了解下这方面的知识了</p></blockquote><p>假设目标设备已经安装docker，但是无法正常使用docker pull。那么找到一个有网络条件的设备，使用<code>docker pull</code>命令从Docker Hub或其他仓库拉取所需的镜像。完成后，使用<code>docker save</code>命令将镜像保存到文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o /path/to/image.tar imageName:tag</span><br></pre></td></tr></table></figure><p>完成后，将生成的<code>.tar</code>文件复制到存储介质中。</p><p>在无网络设备上插上你的存储设备，使用<code>docker load</code>命令从<code>.tar</code>文件中加载镜像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i /path/to/image.tar</span><br></pre></td></tr></table></figure><p>后续用法就没啥区别了。</p><h2 id="疑难杂症"><a href="#疑难杂症" class="headerlink" title="疑难杂症"></a>疑难杂症</h2><h3 id="tls-failed-to-verify-certificate-x509-certificate-signed-by-unknown-authority"><a href="#tls-failed-to-verify-certificate-x509-certificate-signed-by-unknown-authority" class="headerlink" title="tls: failed to verify certificate: x509: certificate signed by unknown authority"></a><code>tls: failed to verify certificate: x509: certificate signed by unknown authority</code></h3><p>现象是，在容器内会发现https连接不可用，都会报上面的错误。但是容器的宿主机连接正常。</p><p>报错内容是证书由未知机构签署。原因是基于https的web连接基于tls机制来认证连接双方可信，并且不会存在中间人攻击（即，在你到服务器的通信中，第三方几乎不可能解密你们加密后的通信内容）。但是因为基于tls可信原理的条件进行推导，最终会得出必须存在一个可信根证书预先分发给客户端的结论。</p><blockquote><p>x509是一个标准，它定义了公钥证书的格式，这些证书用于TLS和其他加密通信。</p></blockquote><p>所以，上面的错误表示证书部分出现错误。未知证书表示客户端没有信任签发服务器证书的证书颁发机构（CA）。客户端的信任存储中没有包含该CA的证书，因此无法验证服务器证书的有效性。</p><p>因此鉴定为容器镜像里边缺tls证书了。</p><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ul><li>在容器中执行<code>apt-get install ca-certificates</code></li><li>在映射中添加如下映射：<code>/etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt</code></li><li>在映射中添加如下映射：<code>/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</code></li></ul><p>如果是<code>ubuntu:latest</code>的话，那大概率已经安装<code>ca-certificates</code>，执行2，3尝试即可。</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul><li>Docker官方文档：<a href="https://docs.docker.com/">https://docs.docker.com/</a></li></ul>